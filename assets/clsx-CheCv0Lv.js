import{u as B,v as S}from"./Avatar-DdgJk9fH.js";import{s as g,I as _,D}from"./Button-DqqQBIgQ.js";import{u as T}from"./useAuth-CUq5kDrt.js";const v={async getAll(){const{data:t,error:r}=await g.from("budgets").select("*").order("created_at",{ascending:!0});if(r)throw r;return t||[]},async create(t){const{data:r,error:a}=await g.from("budgets").insert(t).select().single();if(a)throw a;return r},async update(t,r){const{data:a,error:s}=await g.from("budgets").update(r).eq("id",t).select().single();if(s)throw s;return a},async delete(t){const{error:r}=await g.from("budgets").delete().eq("id",t);if(r)throw r}};function O(t="2025-10"){const{user:r,isDemoMode:a,demoOverrides:s}=T(),{data:i}=B();return S({queryKey:["budgets",t,r==null?void 0:r.id],queryFn:async()=>{let u;a?s.budgets?u=structuredClone(s.budgets):u=_.map((e,n)=>({...e,id:n+1,user_id:D,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})):u=await v.getAll();const p=u.reduce((e,n)=>e+n.maximum,0),b=u.map(e=>e.theme),d=u.map(e=>e.category),l=i.filter(e=>d.includes(e.category)&&e.transaction_date.startsWith(t)),w=l.reduce((e,n)=>e+Math.abs(n.amount),0),f=d.reduce((e,n)=>(e[n]=l.filter(o=>o.category===n).reduce((o,c)=>o+Math.abs(c.amount),0),e),{}),m=d.reduce((e,n)=>(e[n]=[...l].filter(o=>o.category===n).sort((o,c)=>new Date(c.transaction_date).getTime()-new Date(o.transaction_date).getTime()),e),{}),h=d.reduce((e,n)=>(e[n]=m[n].slice(0,2),e),{});return{budgets:u.slice().sort((e,n)=>{const o=f[e.category];return f[n.category]-o}),usedCategories:d,spentWithinBudgets:w,spentByCategory:f,totalLimit:p,usedColors:b,transactionsByCategory:m,latestTransactionsByCategory:h}}})}function y(t){var r,a,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(r=0;r<i;r++)t[r]&&(a=y(t[r]))&&(s&&(s+=" "),s+=a)}else for(a in t)t[a]&&(s&&(s+=" "),s+=a);return s}function q(){for(var t,r,a=0,s="",i=arguments.length;a<i;a++)(t=arguments[a])&&(r=y(t))&&(s&&(s+=" "),s+=r);return s}export{v as b,q as c,O as u};
