import{u as D,v as B}from"./Avatar-C23dFxrF.js";import{s as g,D as m,I as p}from"./Button-DqqQBIgQ.js";import{u as I}from"./useAuth-CUq5kDrt.js";const T={async getAll(){const{data:e,error:r}=await g.from("budgets").select("*").order("created_at",{ascending:!0});if(r)throw r;return e||[]},async create(e){const{data:r,error:n}=await g.from("budgets").insert(e).select().single();if(n)throw n;return r},async update(e,r){const{data:n,error:s}=await g.from("budgets").update(r).eq("id",e).select().single();if(s)throw s;return n},async delete(e){const{error:r}=await g.from("budgets").delete().eq("id",e);if(r)throw r}};function q(e="2025-10"){const{user:r,isDemoMode:n,demoOverrides:s}=I(),{data:u}=D();return B({queryKey:["budgets",e,r==null?void 0:r.id],queryFn:async()=>{let i;if(n)if(s.budgets)i=structuredClone(s.budgets);else try{const{data:t,error:a}=await g.from("budgets").select("*").eq("user_id",m).order("created_at",{ascending:!0});if(a)throw a;t&&t.length>0?i=t:i=p.map((o,d)=>({...o,id:d+1,user_id:m,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}))}catch(t){console.warn("Failed to fetch demo budgets from DB, using fallback",t),i=p.map((a,o)=>({...a,id:o+1,user_id:m,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}))}else i=await T.getAll();const w=i.reduce((t,a)=>t+a.maximum,0),h=i.map(t=>t.theme),c=i.map(t=>t.category),l=u.filter(t=>c.includes(t.category)&&t.transaction_date.startsWith(e)),_=l.reduce((t,a)=>t+Math.abs(a.amount),0),f=c.reduce((t,a)=>(t[a]=l.filter(o=>o.category===a).reduce((o,d)=>o+Math.abs(d.amount),0),t),{}),y=c.reduce((t,a)=>(t[a]=[...l].filter(o=>o.category===a).sort((o,d)=>new Date(d.transaction_date).getTime()-new Date(o.transaction_date).getTime()),t),{}),S=c.reduce((t,a)=>(t[a]=y[a].slice(0,2),t),{});return{budgets:i.slice().sort((t,a)=>{const o=f[t.category];return f[a.category]-o}),usedCategories:c,spentWithinBudgets:_,spentByCategory:f,totalLimit:w,usedColors:h,transactionsByCategory:y,latestTransactionsByCategory:S}}})}function b(e){var r,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var u=e.length;for(r=0;r<u;r++)e[r]&&(n=b(e[r]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function M(){for(var e,r,n=0,s="",u=arguments.length;n<u;n++)(e=arguments[n])&&(r=b(e))&&(s&&(s+=" "),s+=r);return s}export{T as b,M as c,q as u};
